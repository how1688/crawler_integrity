2025-08-29 21:25:25,160 - INFO - ✓ Gemini API (gemini-2.5-flash-lite) 初始化成功
2025-08-29 21:25:25,479 - INFO - ✓ Supabase 連線 (https://iiqimdwocmqtiudfezlh.supabase.co) 初始化成功
2025-08-29 21:25:25,480 - INFO - ================================================================================
2025-08-29 21:25:25,481 - INFO -   困難關鍵字提取系統 - 可存入資料庫版本
2025-08-29 21:25:25,481 - INFO - ================================================================================
2025-08-29 21:25:25,481 - INFO - === 讀取合併資料 ===
2025-08-29 21:25:25,482 - INFO - 讀取 single_news 資料...
2025-08-29 21:25:25,762 - INFO - 讀取所有資料
2025-08-29 21:25:26,419 - INFO - 成功讀取 107 筆新聞資料
2025-08-29 21:25:26,422 - INFO - 讀取 term_map 資料...
2025-08-29 21:25:26,653 - INFO - 成功讀取 1000 筆 term_map 資料
2025-08-29 21:25:26,654 - INFO - 組織 term_map: 155 個不同的 story_id
2025-08-29 21:25:26,655 - INFO - 合併完成: 107 筆新聞資料
2025-08-29 21:25:26,655 - INFO - === 階段一：從新聞中提取困難關鍵字 ===
2025-08-29 21:28:23,507 - INFO - ✓ 階段一完成：共提取 546 個不重複關鍵字。
2025-08-29 21:28:23,507 - INFO - === 階段二：為關鍵字生成解釋與範例 ===
2025-08-29 21:29:30,602 - WARNING - ✗ JSON 解析錯誤 (嘗試 1/3): Invalid control character at: line 7 column 60 (char 223)
2025-08-29 21:47:45,363 - INFO - ✓ 階段二完成：共成功解釋 546 個詞彙。
2025-08-29 21:47:45,364 - INFO - === 階段三：檢查重複性並準備插入 ===
2025-08-29 21:47:45,365 - INFO - === 檢查 term_map 重複性 ===
2025-08-29 21:47:47,655 - INFO - === 階段四：執行資料庫插入 ===
2025-08-29 21:47:47,656 - INFO - === 開始插入 term 資料 ===
2025-08-29 21:47:47,656 - INFO - 準備插入 480 筆資料到 term 表
2025-08-29 21:47:48,172 - INFO - ✓ 批次 1: 成功插入 50 筆
2025-08-29 21:47:48,704 - INFO - ✓ 批次 2: 成功插入 50 筆
2025-08-29 21:47:49,052 - INFO - ✓ 批次 3: 成功插入 50 筆
2025-08-29 21:47:49,420 - INFO - ✓ 批次 4: 成功插入 50 筆
2025-08-29 21:47:49,776 - INFO - ✓ 批次 5: 成功插入 50 筆
2025-08-29 21:47:50,127 - ERROR - ✗ 批次 6 發生錯誤: {'message': 'duplicate key value violates unique constraint "term_pkey"', 'code': '23505', 'hint': None, 'details': 'Key (term)=(熱帶性低氣壓) already exists.'}
2025-08-29 21:47:50,366 - ERROR - ✗ 批次 7 發生錯誤: {'message': 'duplicate key value violates unique constraint "term_pkey"', 'code': '23505', 'hint': None, 'details': 'Key (term)=(終結者) already exists.'}
2025-08-29 21:47:50,598 - ERROR - ✗ 批次 8 發生錯誤: {'message': 'duplicate key value violates unique constraint "term_pkey"', 'code': '23505', 'hint': None, 'details': 'Key (term)=(腰椎壓迫性骨折) already exists.'}
2025-08-29 21:47:50,828 - ERROR - ✗ 批次 9 發生錯誤: {'message': 'duplicate key value violates unique constraint "term_pkey"', 'code': '23505', 'hint': None, 'details': 'Key (term)=(輝達) already exists.'}
2025-08-29 21:47:51,061 - ERROR - ✗ 批次 10 發生錯誤: {'message': 'duplicate key value violates unique constraint "term_pkey"', 'code': '23505', 'hint': None, 'details': 'Key (term)=(骨質疏鬆) already exists.'}
2025-08-29 21:47:51,062 - INFO - term 插入結果:
2025-08-29 21:47:51,062 - INFO -   成功: 250 筆
2025-08-29 21:47:51,063 - INFO -   失敗: 230 筆
2025-08-29 21:47:51,063 - INFO - === 開始插入 term_map 資料 ===
2025-08-29 21:47:51,064 - INFO - 準備插入 609 筆資料到 term_map 表
2025-08-29 21:47:51,358 - ERROR - ✗ 批次 1 發生錯誤: {'message': 'insert or update on table "term_map" violates foreign key constraint "term_map_term_fkey"', 'code': '23503', 'hint': None, 'details': 'Key (term)=(體育部) is not present in table "term".'}
2025-08-29 21:47:51,648 - ERROR - ✗ 批次 2 發生錯誤: {'message': 'insert or update on table "term_map" violates foreign key constraint "term_map_term_fkey"', 'code': '23503', 'hint': None, 'details': 'Key (term)=(航、港、船、遊) is not present in table "term".'}
2025-08-29 21:47:51,898 - ERROR - ✗ 批次 3 發生錯誤: {'message': 'insert or update on table "term_map" violates foreign key constraint "term_map_term_fkey"', 'code': '23503', 'hint': None, 'details': 'Key (term)=(誹謗) is not present in table "term".'}
2025-08-29 21:47:52,230 - ERROR - ✗ 批次 4 發生錯誤: {'message': 'insert or update on table "term_map" violates foreign key constraint "term_map_term_fkey"', 'code': '23503', 'hint': None, 'details': 'Key (term)=(颱風窩) is not present in table "term".'}
2025-08-29 21:47:52,549 - ERROR - ✗ 批次 5 發生錯誤: {'message': 'insert or update on table "term_map" violates foreign key constraint "term_map_term_fkey"', 'code': '23503', 'hint': None, 'details': 'Key (term)=(跨班次搭乘) is not present in table "term".'}
2025-08-29 21:47:52,843 - ERROR - ✗ 批次 6 發生錯誤: {'message': 'insert or update on table "term_map" violates foreign key constraint "term_map_term_fkey"', 'code': '23503', 'hint': None, 'details': 'Key (term)=(註冊) is not present in table "term".'}
2025-08-29 21:47:53,094 - ERROR - ✗ 批次 7 發生錯誤: {'message': 'insert or update on table "term_map" violates foreign key constraint "term_map_term_fkey"', 'code': '23503', 'hint': None, 'details': 'Key (term)=(靜息態腦活動) is not present in table "term".'}
2025-08-29 21:47:53,094 - INFO - term_map 插入結果:
2025-08-29 21:47:53,095 - INFO -   成功: 0 筆
2025-08-29 21:47:53,095 - INFO -   失敗: 609 筆
2025-08-29 21:47:53,096 - INFO - ================================================================================
2025-08-29 21:47:53,096 - INFO -   執行完成摘要
2025-08-29 21:47:53,096 - INFO - ================================================================================
2025-08-29 21:47:53,096 - INFO - ✓ 處理新聞數量: 107
2025-08-29 21:47:53,097 - INFO - ✓ 不重複關鍵字: 546
2025-08-29 21:47:53,097 - INFO - ✓ 成功解釋詞彙: 546
2025-08-29 21:47:53,097 - INFO - ✗ 失敗 插入 term 表: 480 個新關鍵字
2025-08-29 21:47:53,097 - INFO - ✗ 失敗 插入 term_map 表: 609 筆新組合
2025-08-29 21:47:53,097 - INFO - ================================================================================
